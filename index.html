<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Universal Bond Calculator</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">

  <style>
    .navbar-brand {
      width: 5%;
      margin-bottom: 8;
    }
  </style>
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar has-background-danger-dark" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">
      <a>
        <img src="images/Wisconsin-Crest-Logo.png" width="85%" height="15%">
      </a>

      <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>

    <div id="navbarBasicExample" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item has-text-white">
          Home
        </a>
        <a href="savedbonds.html" class="navbar-item has-text-white">
          Saved Bonds
        </a>
      </div>
    </div>

    <div class="navbar-end">
      <div class="navbar-item">
        <div class="buttons">
          <a class="js-modal-trigger button is-light" data-target="sign_up">
            Sign up
          </a>
          <a class="js-modal-trigger button is-light" data-target="log_in">
            Log in
          </a>
          <a class="js-modal-trigger button is-light" data-target="account_info">
            Account Info
          </a>
        </div>
      </div>
    </div>
    </div>
  </nav>
  <!-- Hero -->
  <section class="hero has-text-centered has-background-grey-lighter">
    <div class="hero-body">
      <p class="title">
        Welcome to the Universal Bond Calculator
      </p>
      <p class="subtitle">
        This application outputs bond payment data based on the bond inputs that you specify. <br>
        In order to save your work, please create an account or log in<br> <br>
      </p>
      <button class="js-modal-trigger  button is-larger has-background-danger-dark is-large" data-target="bond_input">
        <p class="has-text-white">
          Get Started
        </p>

      </button>
    </div>
  </section>
  <!-- About Us -->
  <section class="hero has-text-centered ">
    <div class="hero-body">
      <p class="title">
        About Us
      </p>
      <!-- Card -->

      <div class="columns has-text-centered">
        <div class="column">
          <!-- Card - row 1, column 1 -->
          <div class="card">
            <div class="card-image">
              <figure class="image is-4by3">
                <img src="images/Erwan_Quintin_Headshot.jpg" alt="Erwan Quintin Headshot">
              </figure>
            </div>
            <header class="card-header">
              <p class="card-header-title">
                Professor Erwan Quintin
              </p>
              <button class="card-header-icon" aria-label="more options">
                <span class="icon">
                  <i class="fas fa-angle-down" aria-hidden="true"></i>
                </span>
              </button>
            </header>
            <div class="card-content">
              <div class="content">
                <p>Erwan Quintin is a professor in and chair of the Department of Finance, Investment, and Banking. He
                  is also the Nathan S. Brand Chair in Finance. He came to Wisconsin in 2010 from the Federal Reserve
                  Bank of Dallas, where he had worked as a senior economist and policy advisor since 2000. His research
                  lies at the intersection of Financial Economics and Macroeconomics. Quintin earned his Ph.D. in
                  Economics from the University of Minnesota.</p>
              </div>
            </div>
            <footer class="card-footer">
              <a href="http://erwan.marginalq.com/" class="card-footer-item">Personal Website</a>
            </footer>
          </div><br>
          <!-- Card - row 2, column 1 -->
          <div class="card">
            <div class="card-image">
              <figure class="image is-4by3">
                <img src="images/1602030362021.png" alt="Placeholder image">
              </figure>
            </div>
            <header class="card-header">
              <p class="card-header-title">Declan Nashold
              </p>
              <button class="card-header-icon" aria-label="more options">
                <span class="icon">
                  <i class="fas fa-angle-down" aria-hidden="true"></i>
                </span>
              </button>
            </header>
            <div class="card-content">
              <div class="content">
                Hi, I'm a student at University of Wisconsin-Madison studying Operations and Technology
                Management, Information Systems, and Computer Science.
              </div>
            </div>
            <footer class="card-footer">
              <a href="https://www.linkedin.com/in/declan-nashold/" class="card-footer-item">LinkedIn</a>
            </footer>
          </div>
        </div>

        <div class="column">
          <!-- Card - row 1, column 2 -->
          <div class="card">
            <div class="card-image">
              <figure class="image is-4by3">
                <img src="images/Stefan_Picture.JPG" alt="Stefan Picture">
              </figure>
            </div>
            <header class="card-header">
              <p class="card-header-title">
                Stefan Theiss
              </p>
              <button class="card-header-icon" aria-label="more options">
                <span class="icon">
                  <i class="fas fa-angle-down" aria-hidden="true"></i>
                </span>
              </button>
            </header>
            <div class="card-content">
              <div class="content">
                Hi, my name is Stefan. I'm an Information Systems and OTM major at UW Madison and
                will be graduating after this semester. I am hoping to obtain a business analyst
                position for post-grad employment.
              </div>
            </div>
            <footer class="card-footer">
              <a href="https://www.linkedin.com/in/stefan-theiss-107480181/" class="card-footer-item">LinkedIn</a>
            </footer>
          </div><br>
          <!-- Card - row 2, column 2 -->
          <div class="card">
            <div class="card-image">
              <figure class="image is-4by3">
                <img src="images/spencer_picture.jpg" alt="Placeholder image">
              </figure>
            </div>
            <header class="card-header">
              <p class="card-header-title">
                Spencer Hikade
              </p>
              <button class="card-header-icon" aria-label="more options">
                <span class="icon">
                  <i class="fas fa-angle-down" aria-hidden="true"></i>
                </span>
              </button>
            </header>
            <div class="card-content">
              <div class="content">
                Hi! My name is Spencer and I am a senior studying Management and Human Resources and Information
                Systems. I enjoy disc golfing and playing music for various groups back home, and I look forward to
                working in
                Human Resources Analytics after graduation.
              </div>
            </div>
            <footer class="card-footer">
              <!-- PUT LINKEDIN IN HREF -->
              <a href="https://www.linkedin.com/in/spencer-hikade-932057174/" class="card-footer-item">LinkedIn</a>
            </footer>
          </div>
        </div>
        <div class="column">
          <!-- Card - row 1, column 3 -->
          <div class="card">
            <div class="card-image">
              <figure class="image is-4by3">
                <img src="images/guell_headshot.jpg" alt="Mason Guell Photo">
              </figure>
            </div>
            <header class="card-header">
              <p class="card-header-title">
                Mason Guell
              </p>
              <button class="card-header-icon" aria-label="more options">
                <span class="icon">
                  <i class="fas fa-angle-down" aria-hidden="true"></i>
                </span>
              </button>
            </header>
            <div class="card-content">
              <div class="content">
                <p>Hey, I'm Mason Guell and I will be graduating this year with majors in Finance, Risk
                  Management, and
                  Information Systems. My hobbies include staying active, hanging with friends,
                  reading, and travelling.
                  After gradauation, I will be in Milwaukee working for an Investment Bank.</p>
              </div>
            </div>
            <footer class="card-footer">
              <a href="https://www.linkedin.com/in/mason-guell/" class="card-footer-item">LinkedIn</a>
            </footer>
          </div><br>

          <!-- Card - row 2, column 3 -->
          <div class="card">
            <div class="card-image">
              <figure class="image is-4by3">
                <img src="images/Tanner_Headshot.JPG" alt="Photo of Tanner Wagner-Durr">
              </figure>
            </div>
            <header class="card-header">
              <p class="card-header-title">
                Tanner Wagner-Durr
              </p>
              <button class="card-header-icon" aria-label="more options">
                <span class="icon">
                  <i class="fas fa-angle-down" aria-hidden="true"></i>
                </span>
              </button>
            </header>
            <div class="card-content">
              <div class="content">
                <p>Hi, my name is Tanner, and I'm a senior majoring in Finance, Economics, and
                  Information Systems! In my free time, I enjoy sailing, skiing, crypto investing, and
                  watching Badger sporting events.</p>
              </div>
            </div>
            <footer class="card-footer">>
              <a href="https://www.linkedin.com/in/tannerwagner-durr/" class="card-footer-item">LinkedIn</a>
            </footer>
          </div>
        </div>

      </div>
    </div>

  </section>

  <!-- footer -->
  <footer class="footer">
    <div class="content has-text-centered">
      <p> <strong>&copy; Copyright 2022</strong> Declan Nashold, Mason Guell, Spencer Hikade, Stefan Theiss, and
        Tanner
        Wagner-Durr. </p>
      <p>Developed for Prof. Erwan Quintin for use by the students, alumni, staff, and faculty of the University of
        Wisconsin-Madison.</p>
      <p>View the source code of this project on <a href="https://github.com/stheiss25/Group-Project-424">GitHub</a>
      </p>
    </div>
  </footer>

  <!-- sign-up modal -->
  <div id="sign_up" class="modal">
    <div class="modal-background"></div>
    <div class="modal-content">
      <div class="box">
        <button class="modal-close is-large" aria-label="close"></button>
        <h1 class="title is-4">Sign up</h1>
        <form id="signup_form">
          <h2 class="subtitle is-6">Already have an account? <a class="js-modal-trigger adv" data-target="log_in">Log
              in</a>.</h2>

          <!-- Name input -->
          <div class="field">
            <label class="label">Name: </label>
            <div class="control">
              <input type="text" class="input" placeholder="Enter your name">
            </div>
          </div>


          <!-- Class input -->
          <div class="field">
            <label class="label">Class: </label>
            <div class="control">
              <input type="text" class="input" placeholder="For which class are you using this calculator?">
            </div>
          </div>

          <!-- email input -->
          <div class="field">
            <label class="label">Email: </label>
            <div class="control">
              <input id='email' type="email" class="input" placeholder="Enter email address">
            </div>
          </div>

          <!-- password input -->
          <div class="field">
            <label class="label">Password: </label>
            <div class="control">
              <input id='password' type="password" class="input" placeholder="Enter password">
            </div>
          </div>

          <!-- submit button -->
          <br>
          <div class="has-text-left">
            <button type="submit" class="button is-danger">Sign Up</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  </div>
  </div>


  <!-- log in modal -->
  <div id="log_in" class="modal">
    <div class="modal-background"></div>
    <div class="modal-content">
      <div class="box">
        <h1 class="title is-4">Log in</h1>
        <h2 class="subtitle is-6">New user? <a class="js-modal-trigger adv" data-target="sign_up">Sign
            up</a>.</h2>
        <form action="" id="log_in_form" class="mb-0 mt-2 loggedin">
          <!-- email input -->
          <div class="field">
            <label class="label">Email: </label>
            <div class="control">
              <input type="email" class="input" placeholder="Enter email address">
            </div>
          </div>

          <!-- password input -->
          <div class="field">
            <label class="label">Password: </label>
            <div class="control">
              <input type="password" class="input" placeholder="Enter password">
            </div>
          </div>

          <!-- submit button -->
          <br>
          <div class="has-text-left">
            <button type="submit" class="button is-danger">Log in</button>
          </div>
        </form>
      </div>
    </div>
    <button class="modal-close is-large" aria-label="close"></button>
  </div>

  <!-- account-info modal -->
  <div id="account_info" class="modal">
    <div class="modal-background"></div>
    <div class="modal-content">
      <div class="box">
        <button class="modal-close is-large" aria-label="close"></button>
        <h1 class="title is-4">Account Information</h1>
        <form action="" id="change_info" class="mb-0 mt-2 loggedin">
          <!-- Name input -->
          <div class="field">
            <label class="label">Name: </label>
            <div class="control">
              <input type="text" class="input" id="change_name" placeholder="Change your name">
            </div>
          </div>


          <!-- Class input -->
          <div class="field">
            <label class="label">Class: </label>
            <div class="control">
              <input type="text" class="input" id="change_class"
                placeholder="For which class are you using this calculator?">
            </div>
          </div>

          <!-- email input -->
          <div class="field">
            <label class="label">Email: </label>
            <div class="control">
              <input type="email" class="input" id="change_email" placeholder="Change email address">
            </div>
          </div>

          <!-- password input -->
          <div class="field">
            <label class="label">Password: </label>
            <div class="control">
              <input type="password" class="input" id="change_password" placeholder="Change your password">
            </div>
          </div>

          <!-- submit button -->
          <br>
          <div class="has-text-left">
            <button type="submit" class="button is-danger">Log in</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Bond input modal -->
  <div id="bond_input" class="modal">
    <div class="modal-background"></div>
    <div class="modal-content">
      <div class="box">




        <p class="has-text-centered">
          <h1 class="title has-text-centered">
            Enter Bond Information Below!
          </h1>
          <h2 class="subtitle has-text-centered">
            For the best user experience, sign in to save your results.

          </h2>
          <div class="field is-grouped is-grouped-centered">
            <div class="control">
              <button class="js-modal-trigger button is-light adv" data-target="log_in">Log-In</button>
            </div>
            <div class="control">
              <button class="js-modal-trigger button is-light adv" data-target="sign_up">Sign-Up</button>
            </div>
          </div>
        </p>

        <!-- Initial Loan Size -->
        <div class="field ">
          <label class="label ">Initial Loan Size:</label>

          <div class="control">
            <input class="input" id="loan_size" type="text" placeholder="Enter a $ amount (e.g. 1000.00)">
          </div>
        </div>

        <!-- Balloon payment -->
        <div class="field">


          <label class="label">Balloon Payment:</label>
          <div class="control">
            <input class="input" id="balloon_payment" type="text" placeholder="Enter a $ amount (e.g. 1000.00)">
          </div>

        </div>

        <!-- Number of periods -->
        <div class="field">


          <label class="label">Number of Periods:</label>

          <div class="control">
            <input class="input is-right" id="periods" type="text" placeholder="Enter a number (e.g. 1)">
          </div>

        </div>

        <!-- Interest per period -->
        <div class="field ">


          <label class="label">Interest per Period:</label>

          <div class="control">
            <input class="input is-right" id="interest" type="text" placeholder="Enter a decimal (e.g. 0.01 for 1%)">
          </div>

        </div>

        <!-- Number of payments -->
        <div class="field ">


          <label class="label">Payments per Period:</label>

          <div class="control">
            <input class="input is-right" id="payments" type="text" placeholder="Enter a number (e.g. 1)">
          </div>

        </div>

        <!-- growth regimes -->
        <div class="field ">


          <label class="label"># of growth regimes:</label>
          <div class="control">
            <input class="input is-right" id="growth" type="text" placeholder="Enter a number (e.g. 1)">
          </div>

        </div>

        <!-- Submit button -->
        <div class="field is-grouped is-grouped-centered">
          <div class="control">
            <button class="js-modal-trigger button is-light" data-target="graph">Submit</button>
          </div>
          <div class="control">
            <button class="button is-danger is-light adv">Cancel</button>
          </div>
        </div>

      </div>
    </div>

    <button class="modal-close is-large" aria-label="close"></button>
  </div>

  <!-- graph modal -->
  <div id="graph" class="modal">
    <div class="modal-background"></div>
    <div class="modal-content">
      <div class="box">
        <h1 class="title is-4">Bond Payment Graph</h1>
        <br>
        <div class="field has-text-centered">
          <p>Graph goes here</p>
        </div>
        <br>
        <div class="level">
          <!-- back to inputs -->
          <div class="level-left">
            <a class="adv h3 is-5 has-text-danger">Back to inputs</a>
          </div>

          <!-- continue button -->
          <div class="level-right">
            <!-- TODO add link to table page -->
            <button class="button is-light">Looks Good, Show Table</button>
          </div>

        </div>

      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-app.js"></script>

  <!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
  <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-analytics.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-storage.js"></script>

  <!-- Add Firebase products that you want to use -->
  <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-firestore.js"></script>

  <script>
    // TODO
    // Copy **only** your firebaseConfig from Google Firebae and add it below

    // Your web app's Firebase configuration 
    // Import the functions you need from the SDKs you need

    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyBdU9fKpt_UXOCqiSZikUS01RxmrvX8vnI",
      authDomain: "universalbondcalculator.firebaseapp.com",
      projectId: "universalbondcalculator",
      storageBucket: "universalbondcalculator.appspot.com",
      messagingSenderId: "374853779066",
      appId: "1:374853779066:web:0448ac5ea3b2fa467305c3"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    // define authentication variable
    let auth = firebase.auth();
    let db = firebase.firestore();

    // define a storage reference
    let ref = firebase.storage().ref();
  </script>

  <script src="app.js"></script>

</body>

</html>

<script>
  db.collection('users').get().then(response => {
    console.log(response.docs[0].data());
  })

  document.addEventListener('DOMContentLoaded', () => {
    // Functions to open and close a modal
    function openModal($el) {
      $el.classList.add('is-active');
    }

    function closeModal($el) {
      $el.classList.remove('is-active');
    }

    function closeAllModals() {
      (document.querySelectorAll('.modal') || []).forEach(($modal) => {
        closeModal($modal);
      });
    }

    // Add a click event on buttons to open a specific modal
    (document.querySelectorAll('.js-modal-trigger') || []).forEach(($trigger) => {
      const modal = $trigger.dataset.target;
      const $target = document.getElementById(modal);
      console.log($target);

      $trigger.addEventListener('click', () => {
        openModal($target);
      });
    });

    // Add a click event on various child elements to close the parent modal || .adv for closing modal to go to other modal
    (document.querySelectorAll(
      '.modal-background, .modal-close, .modal-card-head .delete, .modal-card-foot .button, .adv') || []).forEach((
      $close) => {
      const $target = $close.closest('.modal');

      $close.addEventListener('click', () => {
        closeModal($target);
      });
    });

    // Add a keyboard event to close all modals
    document.addEventListener('keydown', (event) => {
      const e = event || window.event;

      if (e.keyCode === 27) { // Escape key
        closeAllModals();
      }
    });
  });

  // signup
  let signup_form = document.querySelector('#signup_form')

  signup_form.addEventListener('submit', (e) => {
    e.preventDefault()

    var sign_up_modal = document.querySelector("#sign_up");


    let email = document.querySelector('#email').value
    let password = document.querySelector('#password').value

    auth.createUserWithEmailAndPassword(email, password).then(() => {
      console.log('user created successfully')
      signup_form.reset()
    })

    sign_up_modal.classList.remove('is-active');
  })

  function updateInfo(id, new_name, new_class, new_email, new_password) {
    let name = id.name;
    let email = id.email
    let password = id.password
    let a_class = id.class

    if (new_name !== null) {
      name = new_name
    }
    if (new_class !== null) {
      a_class = new_class
    }
    if (new_email !== null) {
      email = new_email
    }
    if (new_password !== null) {
      password = new_password
    }
    return id.update({
        name: name,
        password: password,
        class: a_class,
        email: email

      })
      .then(() => {
        console.log("Document successfully updated!");
      })
      .catch((error) => {
        // The document probably doesn't exist.
        console.error("Error updating document: ", error);
      });
  }

  let log_in = document.querySelector("#log_in_form");

  log_in.addEventListener('submit', (e) => {
    var login_modal = document.querySelector("#log_in");
    login_modal.classList.remove('is-active');
  })


  let change_info = document.querySelector("#change_info");

  change_info.addEventListener('submit', (e) => {

    var change_modal = document.querySelector("account_info");

    let new_name = document.querySelector('#change_name').value;
    let new_class = document.querySelector('#change_class').value;
    let new_email = document.querySelector('#change_email').value;
    let new_password = document.querySelector('#change_password').value;

    updateinfo(id, new_name, new_class, new_email, new_password)

    change_modal.classList.remove('is-active');
    e.preventDefault();
  })


  // function getTable(principal, int_rate, term_length, balloon_payment, growth_rate) {
  let bnow = 500000
  let rate = .07
  let term = 10
  let balloon = 0
  let growth = 0.005

  let month = [term * 12]
  let cf_pattern = [term * 12]
  for (let i = 0; i < term * 12; i++) {
    month[i] = i + 1
    cf_pattern[i] = 1
  }
  for (let i = 0; i < term * 12; i++) {
    cf_pattern[i + 1] = cf_pattern[i] * (1 + growth)
  }
  console.log(cf_pattern[119])

  let npv = getNPV(rate / 12, 0, cf_pattern)
  let f = npv / (1 + rate / 12)
  console.log(npv)
  // npv is 114.27269606595011

  console.log(f)
  //113.60997123375321

  let payment1 = (bnow - balloon / Math.pow(((1 + rate / 12)), (term * 12))) / f

  let payment = [term * 12]

  for (let i = 0; i < term * 12; i++) {
    payment[i] = payment1 * cf_pattern[i]
  }

  let startprincipal = [term * 12]
  let endprincipal = [term * 12]
  let interestpath = [term * 12]
  for (let i = 0; i < term * 12; i++) {
    startprincipal[i] = bnow
    endprincipal[i] = 1
    interestpath[i] = 1
  }

  for (let i = 0; i < term * 12; i++) {
    interestpath[i] = startprincipal[i] * rate / 12
    endprincipal[i] = startprincipal[i] + interestpath[i] - payment[i]

    if (i < term * 12 - 1) {
      startprincipal[i + 1] = endprincipal[i]
    }
  }

  console.log(startprincipal)
  let my_table = [term * 12]

  for (let i = 0; i < term * 12; i++) {
    my_table[i] = [month[i], startprincipal[i], payment[i], interestpath[i], endprincipal[i]]
  }
  console.log(my_table)



  function getNPV(rate, initialCost, cashFlows) {
    var npv = initialCost;

    for (var i = 1; i < cashFlows.length; i++) {
      npv += cashFlows[i] / Math.pow(rate + 1, i + 1);
    }

    npv += cashFlows[0] / (rate + 1)

    return npv;
  }
</script>